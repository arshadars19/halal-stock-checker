<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Halal Stock Checker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: "Segoe UI", sans-serif;
            background-color: #f8fafc;
            text-align: center;
            padding: 40px;
            color: #1e293b;
        }

        h1 {
            color: #0f766e;
        }

        input {
            padding: 10px 15px;
            width: 300px;
            border-radius: 8px;
            border: 1px solid #cbd5e1;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            background-color: #0f766e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 8px;
        }

        button:hover {
            background-color: #115e59;
        }

        #result {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }

        .autocomplete-items {
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            max-height: 150px;
            overflow-y: auto;
            position: absolute;
            background-color: #fff;
            z-index: 99;
            width: 300px;
            left: 50%;
            transform: translateX(-50%);
        }

        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
        }

        .autocomplete-items div:hover {
            background-color: #e9e9e9;
        }
    </style>
</head>
<style>
    body {
        background-image: url('finance_investment_bg.png');
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center center;
        background-attachment: fixed;
        background-color: #004d40;
    }
</style>

<body>
    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:60vh;">
        <div
            style="background:rgba(255,255,255,0.9); border-radius:16px; padding:20px; box-shadow:0 4px 24px rgba(0,0,0,0.15); margin-bottom:20px;">
            <img src="New Logo.png" alt="Halal Finance Simplified Logo" style="width:120px;">
        </div>
        <div
            style="background:rgba(255,255,255,0.92); border-radius:18px; padding:24px 32px; box-shadow:0 4px 24px rgba(0,0,0,0.15); margin-bottom:24px; text-align:center;">
            <h1 style="color:#1a3a32; margin-bottom:16px;">Halal Stock Checker</h1>
            <h3 style="color:#1a3a32; margin-top:0;">
                A product of
                <a href="https://www.instagram.com/halalfinancesimplified/" target="_blank"
                    style="color:#1a3a32; text-decoration:underline;">Halal Finance Simplified</a>
            </h3>
        </div>
    </div>
    <!-- Add after the existing button -->
    <div style="margin: 10px 0;">
        <button onclick="checkStock()">Check Halal List</button>
        <button onclick="checkT0Stock()" style="background-color: #047857;">Check T0 List</button>
    </div>
    <div id="result"></div>
    <div id="t0result"></div>
    <div
        style="display:inline-block; background:rgba(255,255,255,0.85); border-radius:12px; padding:16px 24px; box-shadow:0 2px 12px rgba(0,0,0,0.12); margin-top:16px;">
        <p>Type any company name or ticker below:</p>
    </div>

    <div style="position: relative;">
        <input type="text" id="searchInput" placeholder="e.g. ABB, Aarti Drugs" />
        <div id="autocomplete-list" class="autocomplete-items"></div>
    </div>

    <script>
        // Stock lists
        let halalList = [];
        let halalT0List = [];
        
        // Helper function to load CSV data
        async function loadStockData(filename) {
            try {
                const response = await fetch(filename);
                const data = await response.arrayBuffer();
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                return XLSX.utils.sheet_to_json(sheet).map(row => ({
                    name: row["Company Name"].toString().trim(),
                    ticker: row["Ticker"].toString().trim()
                }));
            } catch (err) {
                console.error(`Error loading ${filename}:`, err);
                return [];
            }
        }

        // Load both lists in parallel
        Promise.all([
            loadStockData('halal_list.csv'),
            loadStockData('intraday_stocks.csv')
        ]).then(([halal, t0]) => {
            halalList = halal;
            halalT0List = t0;
            console.log("✅ Loaded", halalList.length, "halal stocks and", halalT0List.length, "T0 stocks");
        });

        // DOM elements
        const searchInput = document.getElementById('searchInput');
        const autocompleteList = document.getElementById('autocomplete-list');
        
        // Debounce function for search optimization
        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        // Search and filter stocks
        function searchStocks(query) {
            if (!query) return [];
            query = query.toLowerCase();
            
            // Combine both lists and remove duplicates
            const allStocks = [...halalList, ...halalT0List];
            const uniqueStocks = Array.from(new Set(allStocks.map(JSON.stringify))).map(JSON.parse);
            
            return uniqueStocks
                .filter(s => 
                    s.name.toLowerCase().includes(query) || 
                    s.ticker.toLowerCase().includes(query)
                )
                .slice(0, 10);
        }

        // Update autocomplete list
        const updateAutocomplete = debounce(function(value) {
            autocompleteList.innerHTML = '';
            if (!value) return;

            const matches = searchStocks(value);
            matches.forEach(match => {
                const item = document.createElement('div');
                item.innerHTML = `<strong>${match.name}</strong> (${match.ticker})`;
                item.addEventListener('click', () => {
                    searchInput.value = match.ticker;
                    autocompleteList.innerHTML = '';
                });
                autocompleteList.appendChild(item);
            });
        }, 300);

        // Event listeners
        searchInput.addEventListener('input', e => updateAutocomplete(e.target.value));

        // Close autocomplete on outside click
        document.addEventListener('click', e => {
            if (e.target !== searchInput) autocompleteList.innerHTML = '';
        });

        // Helper function to check stock in a list
        function checkStockInList(list, query, resultDiv, listName) {
            if (!query) {
                resultDiv.innerHTML = '⚠️ Please enter a company name or ticker.';
                resultDiv.style.color = '#ca8a04';
                return;
            }

            query = query.toLowerCase().trim();
            
            // First try exact ticker match
            const foundByTicker = list.some(s => s.ticker.toLowerCase().trim() === query);
            
            // Then try exact name match
            const foundByExactName = !foundByTicker && list.some(s => s.name.toLowerCase().trim() === query);
            
            // Finally try partial matches
            const foundByPartialMatch = !foundByTicker && !foundByExactName && list.some(
                s => s.name.toLowerCase().includes(query) || s.ticker.toLowerCase().includes(query)
            );

            const found = foundByTicker || foundByExactName || foundByPartialMatch;

            resultDiv.style.backgroundColor = 'white';
            if (found) {
                resultDiv.innerHTML = `✅ This stock is in <b>${listName}</b>`;
                resultDiv.style.color = 'green';
            } else {
                resultDiv.innerHTML = `❌ This stock Not Found in <b>${listName}</b>`;
                resultDiv.style.color = 'red';
            }
        }

        // Check functions
        function checkStock() {
            const query = searchInput.value;
            checkStockInList(halalList, query, document.getElementById('result'), 'HALAL LIST');
        }

        function checkT0Stock() {
            const query = searchInput.value;
            checkStockInList(halalT0List, query, document.getElementById('t0result'), 'T0 LIST');
        }

    </script>
    <div
        style="display:inline-block; background:rgba(255,255,255,0.85); border-radius:12px; padding:16px 24px; box-shadow:0 2px 12px rgba(0,0,0,0.12); margin-top:16px;">
        <p style="color:#1a3a32; margin-bottom:8px;">
            Disclaimer :- The above data is fetched from
            <a href="https://zamzam-capital.com/halal-stocks/" target="_blank" style="color:#1a3a32;">Zamzam Capital</a>
            website.
            If you want to know how they purify it, please visit their website for more details.
        </p>
        <p style="color:#1a3a32;">
            The list was last updated on April 26, 2025.
        </p>
    </div>
    <div
        style="display:inline-block; background:rgba(255,255,255,0.85); border-radius:12px; padding:16px 24px; box-shadow:0 2px 12px rgba(0,0,0,0.12); margin-top:16px;">
        <p style="color: #000000; margin-top: 30px; font-size: 14px; text-align: center;">
            Developed with ❤️ by
            <a href="https://www.instagram.com/halalfinancesimplified/" target="_blank"
                style="color: #000000; text-decoration: none; font-weight: bold;">Halal Finance Simplified</a>
        </p>
    </div>

</body>

</html>